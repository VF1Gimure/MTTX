schema: '2.0'
stages:
  load_data:
    cmd: python pipelines/src/load_data.py data/raw/KnightX_exp_dataset data/processed/train_data.pt
    deps:
    - path: data/raw
      hash: md5
      md5: 85a754daf6d545eea6579741581f4dde.dir
      size: 1169603990
      nfiles: 5006
    - path: pipelines/src/load_data.py
      hash: md5
      md5: 584d24811d59a25b5ff7b34eb61ce9d2
      size: 1682
    - path: pipelines/utils/transformers_setup.py
      hash: md5
      md5: b4eee6d54525b20f76c5136b2cd21a31
      size: 565
    outs:
    - path: data/processed/train_data.pt
      hash: md5
      md5: 02f4978f91dd9622ba376ea752efe52f
      size: 940
  load.compute_mean_std:
    cmd: python pipelines/utils/compute_mean_std.py mean_std.csv
    deps:
    - path: data/raw/KnightX_exp_dataset
      hash: md5
      md5: c1b6a3f3f6d58c547ad5ef52d024d9b9.dir
      size: 1011643113
      nfiles: 4681
    - path: pipelines/utils/compute_mean_std.py
      hash: md5
      md5: d80e00135933b998fec4ab253cbaed79
      size: 703
    outs:
    - path: data/processed/mean_std.csv
      hash: md5
      md5: 6a939e13ec162214a35c86de3429ba4b
      size: 117
  load.train_data:
    cmd: python pipelines/src/load_data.py mean_std.csv train_data.pt
    deps:
    - path: pipelines/src/load_data.py
      hash: md5
      md5: b90e1cb88d96b57325c52855377f4981
      size: 1360
    outs:
    - path: data/processed/train_data.pt
      hash: md5
      md5: 9b32f7d5bacb0b5da62d9a804349ee25
      size: 81438855030
  preprocess.extract_boxes:
    cmd: python pipelines/src/preprocess_extract_boxes.py train_data.pt mtcnn_boxes.pkl
      mean_std.csv
    deps:
    - path: data/processed/mean_std.csv
      hash: md5
      md5: 6a939e13ec162214a35c86de3429ba4b
      size: 117
    - path: data/processed/train_data.pt
      hash: md5
      md5: 9b32f7d5bacb0b5da62d9a804349ee25
      size: 81438855030
    - path: pipelines/src/preprocess_extract_boxes.py
      hash: md5
      md5: d89ef829bdf4fa033b0f384550a58af5
      size: 1379
    outs:
    - path: data/processed/mtcnn_boxes.pkl
      hash: md5
      md5: 88b00d21fadf5e02b0be51c860d1ecd3
      size: 327509
  preprocess.filter_faces:
    cmd: python pipelines/src/preprocess_filter_faces.py mtcnn_boxes.pkl train_data.pt
      filtered_boxes.pkl filtered_angles.pkl
    deps:
    - path: data/processed/mtcnn_boxes.pkl
      hash: md5
      md5: 88b00d21fadf5e02b0be51c860d1ecd3
      size: 327509
    - path: data/processed/train_data.pt
      hash: md5
      md5: 9b32f7d5bacb0b5da62d9a804349ee25
      size: 81438855030
    - path: pipelines/src/preprocess_filter_faces.py
      hash: md5
      md5: 1d32f089ff45119aee5ad529d6f84fdf
      size: 1443
    outs:
    - path: data/processed/filtered_angles.pkl
      hash: md5
      md5: d1ceb09e7a1ba3004529a4c989821122
      size: 55380
    - path: data/processed/filtered_boxes.pkl
      hash: md5
      md5: c9ae3c70b720e98df904f6e1d32e872a
      size: 176378
  preprocess.refine_faces:
    cmd: python pipelines/src/preprocess_filter_loaded_data.py train_data.pt filtered_boxes.pkl
      filtered_angles.pkl train_data_filtered.pt
    deps:
    - path: data/processed/filtered_angles.pkl
      hash: md5
      md5: d1ceb09e7a1ba3004529a4c989821122
      size: 55380
    - path: data/processed/filtered_boxes.pkl
      hash: md5
      md5: c9ae3c70b720e98df904f6e1d32e872a
      size: 176378
    - path: data/processed/train_data.pt
      hash: md5
      md5: 9b32f7d5bacb0b5da62d9a804349ee25
      size: 81438855030
    - path: pipelines/src/preprocess_filter_loaded_data.py
      hash: md5
      md5: 4f84e50c1ca86b9d0ac0cdbfa9eb61d3
      size: 1285
    outs:
    - path: data/processed/train_data_filtered.pt
      hash: md5
      md5: 74f86ec8f470625170545c81e906203b
      size: 11463247366
  preprocess.apply_clahe_unsharp:
    cmd: python pipelines/src/preprocess_image.py train_data_filtered.pt train_data_clahe.pt
      mean_std.csv
    deps:
    - path: data/processed/mean_std.csv
      hash: md5
      md5: 6a939e13ec162214a35c86de3429ba4b
      size: 117
    - path: data/processed/train_data_filtered.pt
      hash: md5
      md5: 74f86ec8f470625170545c81e906203b
      size: 11463247366
    - path: pipelines/src/preprocess_image.py
      hash: md5
      md5: af19cfaa5d7a5bf9734516e9a51c89b4
      size: 1297
    outs:
    - path: data/processed/train_data_clahe.pt
      hash: md5
      md5: c4da83ba8b30a976dff4d08889bd4101
      size: 3821328932
  preprocess.extract_dlib_landmarks:
    cmd: python pipelines/src/preprocess_image_landmarks.py train_data_clahe.pt train_data_landmarked.pt
      mean_std.csv
    deps:
    - path: data/model/shape_predictor_68_face_landmarks.dat
      hash: md5
      md5: 73fde5e05226548677a050913eed4e04
      size: 99693937
    - path: data/processed/mean_std.csv
      hash: md5
      md5: 6a939e13ec162214a35c86de3429ba4b
      size: 117
    - path: data/processed/train_data_clahe.pt
      hash: md5
      md5: c4da83ba8b30a976dff4d08889bd4101
      size: 3821328932
    - path: pipelines/src/preprocess_image_landmarks.py
      hash: md5
      md5: 7131e7d8a0730180992c19aabbf690b8
      size: 1217
    outs:
    - path: data/processed/train_data_landmarked.pt
      hash: md5
      md5: dd53a9eac0f2d89bb937cd701706f660
      size: 3822071362
  preprocess.crop_resize_convert:
    cmd: python pipelines/src/preprocess.py train_data_landmarked.pt train_data_2channel_train.pt
      train_data_2channel_test.pt train_data_3channel_train.pt train_data_3channel_test.pt
    deps:
    - path: data/processed/train_data_landmarked.pt
      hash: md5
      md5: dd53a9eac0f2d89bb937cd701706f660
      size: 3822071362
    - path: pipelines/src/preprocess.py
      hash: md5
      md5: 74ec46c71ec37cd2e5ffd71767f38802
      size: 3293
    outs:
    - path: data/processed/train_data_2channel_test.pt
      hash: md5
      md5: cf583befd4f970dd82c936989c92a884
      size: 67084223
    - path: data/processed/train_data_2channel_train.pt
      hash: md5
      md5: 23476c00da28709c76137423c1a93ac6
      size: 267935402
    - path: data/processed/train_data_3channel_test.pt
      hash: md5
      md5: 7565ee1089643a12568efd5b59ffc028
      size: 100601791
    - path: data/processed/train_data_3channel_train.pt
      hash: md5
      md5: a3c4c62ecdcc6e8086e55e5c2ff08af5
      size: 401804970
  train:
    cmd: python pipelines/src/train.py train_data_2channel_train.pt model.pth
    deps:
    - path: data/processed/train_data_2channel_train.pt
      hash: md5
      md5: 23476c00da28709c76137423c1a93ac6
      size: 267935402
    - path: pipelines/src/train.py
      hash: md5
      md5: 62af64e2091b5bb43b1526e414b995ec
      size: 1656
    outs:
    - path: data/model/runs/model.pth
      hash: md5
      md5: a9a5c8d62bb34dc37918c65cb5329435
      size: 6694392
  evaluate:
    cmd: python pipelines/src/evaluate.py train_data_2channel_test.pt model.pth metrics.csv
      conf_matrix.pkl
    deps:
    - path: data/model/runs/model.pth
      hash: md5
      md5: a9a5c8d62bb34dc37918c65cb5329435
      size: 6694392
    - path: data/processed/train_data_2channel_test.pt
      hash: md5
      md5: cf583befd4f970dd82c936989c92a884
      size: 67084223
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 0b6d3789102273802e65d570587e6588
      size: 3683
    outs:
    - path: data/processed/conf_matrix.pkl
      hash: md5
      md5: 2d31ef48e6ab254069a12d05c592a25a
      size: 664
    - path: data/processed/metrics.csv
      hash: md5
      md5: ca9789e829f5f6f5dcce9e77b58780d0
      size: 458
  train_vgg16:
    cmd: python pipelines/src/train.py train_data_3channel_train.pt vgg16
    deps:
    - path: data/processed/train_data_3channel_train.pt
      hash: md5
      md5: a3c4c62ecdcc6e8086e55e5c2ff08af5
      size: 401804970
    - path: pipelines/src/train.py
      hash: md5
      md5: 336b7fff3f812cc6886337dedc8dd648
      size: 5144
    outs:
    - path: data/model/runs/vgg16.pth
      hash: md5
      md5: 4c7165865b72fa03d0a95ca6aa56dcfe
      size: 537182638
  train_resnet:
    cmd: python pipelines/src/train_resnet.py train_data_3channel_train.pt resnet18.pth
    deps:
    - path: data/processed/train_data_3channel_train.pt
      hash: md5
      md5: a3c4c62ecdcc6e8086e55e5c2ff08af5
      size: 401804970
    - path: pipelines/src/train_resnet.py
      hash: md5
      md5: c21362ca10a7634e9558c0357819c036
      size: 1893
    outs:
    - path: data/model/runs/resnet18.pth
      hash: md5
      md5: 01b88ed4fbc1155c359d9f149856a065
      size: 44801020
  train_vit:
    cmd: python pipelines/src/train.py train_data_3channel_train.pt vit vit.pth
    deps:
    - path: data/processed/train_data_3channel_train.pt
      hash: md5
      md5: a3c4c62ecdcc6e8086e55e5c2ff08af5
      size: 401804970
    - path: pipelines/src/train.py
      hash: md5
      md5: 336b7fff3f812cc6886337dedc8dd648
      size: 5144
    outs:
    - path: data/model/runs/vit.pth
      hash: md5
      md5: d2d3c3459b2cdd601134594ded00d2a6
      size: 343268370
  train_efficientnet:
    cmd: python pipelines/src/train.py train_data_3channel_train.pt efficientnet
    deps:
    - path: data/processed/train_data_3channel_train.pt
      hash: md5
      md5: a3c4c62ecdcc6e8086e55e5c2ff08af5
      size: 401804970
    - path: pipelines/src/train.py
      hash: md5
      md5: 336b7fff3f812cc6886337dedc8dd648
      size: 5144
    outs:
    - path: data/model/runs/efficientnet.pth
      hash: md5
      md5: c5bdb3a5ad7f2542af70653f91f86d8a
      size: 16375038
  train_mobilenet:
    cmd: python pipelines/src/train.py train_data_3channel_train.pt mobilenet
    deps:
    - path: data/processed/train_data_3channel_train.pt
      hash: md5
      md5: a3c4c62ecdcc6e8086e55e5c2ff08af5
      size: 401804970
    - path: pipelines/src/train.py
      hash: md5
      md5: 336b7fff3f812cc6886337dedc8dd648
      size: 5144
    outs:
    - path: data/model/runs/mobilenet.pth
      hash: md5
      md5: 4c3d35014881cc995e3b4c1733418223
      size: 9182266
  evaluate_vgg16:
    cmd: python pipelines/src/evaluate.py train_data_3channel_test.pt vgg16.pth metrics_vgg16.pkl
      conf_matrix_vgg16.pkl
    deps:
    - path: data/model/runs/vgg16.pth
      hash: md5
      md5: 4c7165865b72fa03d0a95ca6aa56dcfe
      size: 537182638
    - path: data/processed/train_data_3channel_test.pt
      hash: md5
      md5: 7565ee1089643a12568efd5b59ffc028
      size: 100601791
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 41fc06d124e5754618854984b1fc7293
      size: 5982
    outs:
    - path: data/processed/conf_matrix_vgg16.pkl
      hash: md5
      md5: 4826ee195f356bfed2beef14a8844076
      size: 664
    - path: data/processed/metrics_vgg16.pkl
      hash: md5
      md5: 60e81680b59fa24b9794d887c1ddd8c3
      size: 1831
  evaluate_resnet:
    cmd: python pipelines/src/evaluate.py train_data_3channel_test.pt resnet18.pth
      metrics_resnet.csv conf_matrix_resnet.pkl
    deps:
    - path: data/model/runs/resnet18.pth
      hash: md5
      md5: 01b88ed4fbc1155c359d9f149856a065
      size: 44801020
    - path: data/processed/train_data_3channel_test.pt
      hash: md5
      md5: 7565ee1089643a12568efd5b59ffc028
      size: 100601791
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 0b6d3789102273802e65d570587e6588
      size: 3683
    outs:
    - path: data/processed/conf_matrix_resnet.pkl
      hash: md5
      md5: 4612a1ba0568351cfdcd5d83ef07f20c
      size: 664
    - path: data/processed/metrics_resnet.csv
      hash: md5
      md5: f4fe2bc6b18b5ea84741685060a24d1e
      size: 458
  evaluate_vit:
    cmd: python pipelines/src/evaluate.py train_data_3channel_test.pt vit.pth metrics_vit.pkl
      conf_matrix_vit.pkl
    deps:
    - path: data/model/runs/vit.pth
      hash: md5
      md5: d2d3c3459b2cdd601134594ded00d2a6
      size: 343268370
    - path: data/processed/train_data_3channel_test.pt
      hash: md5
      md5: 7565ee1089643a12568efd5b59ffc028
      size: 100601791
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 41fc06d124e5754618854984b1fc7293
      size: 5982
    outs:
    - path: data/processed/conf_matrix_vit.pkl
      hash: md5
      md5: b74a424af025d541a06695a1d298b7b7
      size: 664
    - path: data/processed/metrics_vit.pkl
      hash: md5
      md5: 5214d3e9c134f38faf4b49242320e359
      size: 1831
  evaluate_efficientnet:
    cmd: python pipelines/src/evaluate.py train_data_3channel_test.pt efficientnet.pth
      metrics_efficientnet.pkl conf_matrix_efficientnet.pkl
    deps:
    - path: data/model/runs/efficientnet.pth
      hash: md5
      md5: c5bdb3a5ad7f2542af70653f91f86d8a
      size: 16375038
    - path: data/processed/train_data_3channel_test.pt
      hash: md5
      md5: 7565ee1089643a12568efd5b59ffc028
      size: 100601791
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 41fc06d124e5754618854984b1fc7293
      size: 5982
    outs:
    - path: data/processed/conf_matrix_efficientnet.pkl
      hash: md5
      md5: cdfcd6a4362733423238e84eb8a600a7
      size: 664
    - path: data/processed/metrics_efficientnet.pkl
      hash: md5
      md5: bef36cd6ccbe157a83ad019f93285053
      size: 1831
  evaluate_mobilenet:
    cmd: python pipelines/src/evaluate.py train_data_3channel_test.pt mobilenet.pth
      metrics_mobilenet.pkl conf_matrix_mobilenet.pkl
    deps:
    - path: data/model/runs/mobilenet.pth
      hash: md5
      md5: 4c3d35014881cc995e3b4c1733418223
      size: 9182266
    - path: data/processed/train_data_3channel_test.pt
      hash: md5
      md5: 7565ee1089643a12568efd5b59ffc028
      size: 100601791
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 41fc06d124e5754618854984b1fc7293
      size: 5982
    outs:
    - path: data/processed/conf_matrix_mobilenet.pkl
      hash: md5
      md5: ba3fecb6aae54de5acc7937cee54a77b
      size: 664
    - path: data/processed/metrics_mobilenet.pkl
      hash: md5
      md5: 4fce668a800a7008bb801e72311dfbe8
      size: 1831
  train_custom_cnn:
    cmd: python pipelines/src/train.py train_data_2channel_train.pt custom_cnn
    deps:
    - path: data/processed/train_data_2channel_train.pt
      hash: md5
      md5: 23476c00da28709c76137423c1a93ac6
      size: 267935402
    - path: pipelines/src/train.py
      hash: md5
      md5: 336b7fff3f812cc6886337dedc8dd648
      size: 5144
    outs:
    - path: data/model/runs/custom_cnn.pth
      hash: md5
      md5: 6ba2de3a6323c9e11638df51d610157a
      size: 6696226
  train_mlp:
    cmd: python pipelines/src/train.py train_data_2channel_train.pt mlp
    deps:
    - path: data/processed/train_data_2channel_train.pt
      hash: md5
      md5: 23476c00da28709c76137423c1a93ac6
      size: 267935402
    - path: pipelines/src/train.py
      hash: md5
      md5: 336b7fff3f812cc6886337dedc8dd648
      size: 5144
    outs:
    - path: data/model/runs/mlp.pth
      hash: md5
      md5: bcf489a2561905d3b47ad7dcf5ca3a03
      size: 8452382
  train_deep_capsule:
    cmd: python pipelines/src/train.py train_data_2channel_train.pt deep_capsule
    deps:
    - path: data/processed/train_data_2channel_train.pt
      hash: md5
      md5: 23476c00da28709c76137423c1a93ac6
      size: 267935402
    - path: pipelines/src/train.py
      hash: md5
      md5: 336b7fff3f812cc6886337dedc8dd648
      size: 5144
    outs:
    - path: data/model/runs/deep_capsule.pth
      hash: md5
      md5: 9555caf4c7f442e7c267dcc410f53730
      size: 1534348604
  train_capsule:
    cmd: python pipelines/src/train.py train_data_2channel_train.pt capsule
    deps:
    - path: data/processed/train_data_2channel_train.pt
      hash: md5
      md5: 23476c00da28709c76137423c1a93ac6
      size: 267935402
    - path: pipelines/src/train.py
      hash: md5
      md5: 336b7fff3f812cc6886337dedc8dd648
      size: 5144
    outs:
    - path: data/model/runs/capsule.pth
      hash: md5
      md5: cf9c1d3e9b53c488a2ee40b4f777f659
      size: 1439079240
  train_resnet18:
    cmd: python pipelines/src/train.py train_data_3channel_train.pt resnet18
    deps:
    - path: data/processed/train_data_3channel_train.pt
      hash: md5
      md5: a3c4c62ecdcc6e8086e55e5c2ff08af5
      size: 401804970
    - path: pipelines/src/train.py
      hash: md5
      md5: 336b7fff3f812cc6886337dedc8dd648
      size: 5144
    outs:
    - path: data/model/runs/resnet18.pth
      hash: md5
      md5: dd9c9eebcb1689885f106d4e84440d40
      size: 44801020
  evaluate_custom_cnn:
    cmd: python pipelines/src/evaluate.py train_data_2channel_test.pt custom_cnn.pth
      metrics_custom_cnn.pkl conf_matrix_custom_cnn.pkl
    deps:
    - path: data/model/runs/custom_cnn.pth
      hash: md5
      md5: 6ba2de3a6323c9e11638df51d610157a
      size: 6696226
    - path: data/processed/train_data_2channel_test.pt
      hash: md5
      md5: cf583befd4f970dd82c936989c92a884
      size: 67084223
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 41fc06d124e5754618854984b1fc7293
      size: 5982
    outs:
    - path: data/processed/conf_matrix_custom_cnn.pkl
      hash: md5
      md5: e685a3f30d50e9ff77de0334768c4f77
      size: 664
    - path: data/processed/metrics_custom_cnn.pkl
      hash: md5
      md5: c0f05795dd7c06ee39bb9123069adc16
      size: 1831
  evaluate_mlp:
    cmd: python pipelines/src/evaluate.py train_data_2channel_test.pt mlp.pth metrics_mlp.pkl
      conf_matrix_mlp.pkl
    deps:
    - path: data/model/runs/mlp.pth
      hash: md5
      md5: bcf489a2561905d3b47ad7dcf5ca3a03
      size: 8452382
    - path: data/processed/train_data_2channel_test.pt
      hash: md5
      md5: cf583befd4f970dd82c936989c92a884
      size: 67084223
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 41fc06d124e5754618854984b1fc7293
      size: 5982
    outs:
    - path: data/processed/conf_matrix_mlp.pkl
      hash: md5
      md5: 3203f9281db0dbec9a6fceedb06ce1df
      size: 664
    - path: data/processed/metrics_mlp.pkl
      hash: md5
      md5: 3a8797df8af0ff7271e8f2637317167d
      size: 1831
  evaluate_deep_capsule:
    cmd: python pipelines/src/evaluate.py train_data_2channel_test.pt deep_capsule.pth
      metrics_deep_capsule.pkl conf_matrix_deep_capsule.pkl
    deps:
    - path: data/model/runs/deep_capsule.pth
      hash: md5
      md5: 9555caf4c7f442e7c267dcc410f53730
      size: 1534348604
    - path: data/processed/train_data_2channel_test.pt
      hash: md5
      md5: cf583befd4f970dd82c936989c92a884
      size: 67084223
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 41fc06d124e5754618854984b1fc7293
      size: 5982
    outs:
    - path: data/processed/conf_matrix_deep_capsule.pkl
      hash: md5
      md5: 3627dd0ec5abadfe19b842ac079af0bf
      size: 664
    - path: data/processed/metrics_deep_capsule.pkl
      hash: md5
      md5: e72016bc168cafaed6dcc646fc06e9b0
      size: 1831
  evaluate_capsule:
    cmd: python pipelines/src/evaluate.py train_data_2channel_test.pt capsule.pth
      metrics_capsule.pkl conf_matrix_capsule.pkl
    deps:
    - path: data/model/runs/capsule.pth
      hash: md5
      md5: cf9c1d3e9b53c488a2ee40b4f777f659
      size: 1439079240
    - path: data/processed/train_data_2channel_test.pt
      hash: md5
      md5: cf583befd4f970dd82c936989c92a884
      size: 67084223
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 41fc06d124e5754618854984b1fc7293
      size: 5982
    outs:
    - path: data/processed/conf_matrix_capsule.pkl
      hash: md5
      md5: cb19c2c717cb53967ec4ed09cec73615
      size: 664
    - path: data/processed/metrics_capsule.pkl
      hash: md5
      md5: ba8672964ebab47885e7edf7d5cd4ac0
      size: 1831
  evaluate_resnet18:
    cmd: python pipelines/src/evaluate.py train_data_3channel_test.pt resnet18.pth
      metrics_resnet.pkl conf_matrix_resnet.pkl
    deps:
    - path: data/model/runs/resnet18.pth
      hash: md5
      md5: dd9c9eebcb1689885f106d4e84440d40
      size: 44801020
    - path: data/processed/train_data_3channel_test.pt
      hash: md5
      md5: 7565ee1089643a12568efd5b59ffc028
      size: 100601791
    - path: pipelines/src/evaluate.py
      hash: md5
      md5: 41fc06d124e5754618854984b1fc7293
      size: 5982
    outs:
    - path: data/processed/conf_matrix_resnet.pkl
      hash: md5
      md5: add2c4f5fb5110bace5177d4afa23fe4
      size: 664
    - path: data/processed/metrics_resnet.pkl
      hash: md5
      md5: 36a70fc521847a53cb808cb34bb07b43
      size: 1831
